# 安全策略 - 私钥部署专用

## 🔒 安全概述

Web3 School 智能合约项目采用严格的安全策略，**仅支持私钥部署方式**，禁用助记词部署以确保最高安全标准。

## 🚫 禁用的部署方式

### 不支持助记词部署
- ❌ **助记词 (MNEMONIC)**: 已完全移除支持
- ❌ **12/24 词种子短语**: 不接受此类配置
- ❌ **BIP39 助记词**: 任何形式都不被支持

**原因**: 助记词相比私钥有更大的攻击面，容易被社会工程学攻击。

## ✅ 支持的安全部署方式

### 1. 私钥部署 (主要方式)
```env
PRIVATE_KEY=0x1234567890abcdef...
```

**安全要求**:
- 必须以 `0x` 开头
- 长度必须为 66 个字符 (64字符 + 0x前缀)
- 使用硬件钱包生成的私钥
- 定期轮换私钥

### 2. Truffle Dashboard (最安全)
```bash
truffle dashboard
npm run deploy:dashboard
```

**优势**:
- 私钥不离开浏览器钱包
- 支持硬件钱包 (Ledger, Trezor)
- 交易前用户确认
- 零私钥暴露风险

## 🛡️ 私钥安全最佳实践

### 生成安全私钥
1. **使用硬件钱包生成**
   - Ledger Nano S/X
   - Trezor Model T/One
   - SafePal 硬件钱包

2. **使用可信软件生成**
   - MetaMask (官方版本)
   - MyEtherWallet (离线版本)
   - Ethers.js 库生成

### 私钥存储安全
```bash
# ✅ 正确方式 - 环境变量
echo "PRIVATE_KEY=0x..." >> .env

# ❌ 错误方式 - 硬编码
const privateKey = "0x..."; // 永远不要这样做

# ❌ 错误方式 - 提交到代码库
git add .env  # 永远不要提交 .env 文件
```

### 权限控制
- 部署账户使用独立私钥
- 生产环境转移所有权给多签钱包
- 启用合约暂停机制作为后备

## 🔍 部署前安全检查

### 自动安全验证
项目包含自动安全检查机制：

```bash
# 私钥格式验证
if (!PRIVATE_KEY.startsWith('0x')) {
  throw new Error("私钥必须以 0x 开头");
}

# 私钥长度验证
if (PRIVATE_KEY.length !== 66) {
  throw new Error("私钥长度必须为 66 个字符");
}

# 余额充足性检查
if (balance < minimumRequired) {
  throw new Error("账户余额不足");
}
```

### 手动安全检查清单
- [ ] 私钥从可信来源生成
- [ ] 私钥格式正确 (0x开头，66字符)
- [ ] .env 文件未被提交到代码库
- [ ] 账户有足够 ETH 支付 Gas 费用
- [ ] 网络配置正确
- [ ] 已在测试网充分测试

## 🚨 应急响应计划

### 私钥泄露应对
如果怀疑私钥泄露：

1. **立即行动**
   ```bash
   # 暂停所有合约 (如果有权限)
   npm run console:sepolia
   # 在控制台中: platform.pause()
   
   # 转移资产到安全地址
   # 生成新的安全私钥
   ```

2. **损害评估**
   - 检查所有相关地址的交易记录
   - 确认是否有异常操作
   - 评估资金损失情况

3. **恢复措施**
   - 使用新私钥重新部署
   - 通知所有用户合约地址变更
   - 实施额外安全措施

### 合约紧急暂停
```solidity
// 紧急暂停功能已内置
function pause() external onlyOwner {
    _pause();
}

function emergencyWithdraw() external onlyOwner {
    // 紧急提取代币
}
```

## 📋 安全审计清单

### 部署安全
- [ ] 仅使用私钥部署
- [ ] 私钥来源可信且安全
- [ ] 测试网充分验证
- [ ] Gas 价格合理设置
- [ ] 部署后立即验证合约

### 合约安全
- [ ] 使用 OpenZeppelin 安全库
- [ ] 启用重入攻击防护
- [ ] 实现访问控制
- [ ] 添加紧急暂停机制
- [ ] 完整的事件记录

### 运营安全
- [ ] 定期轮换私钥
- [ ] 使用多签钱包管理
- [ ] 监控异常交易
- [ ] 备份重要数据
- [ ] 制定应急计划

## 🎯 安全评级

### 当前安全级别: **高级** 🔐

**评估标准**:
- ✅ 私钥部署 (+25 分)
- ✅ 格式验证 (+15 分)
- ✅ 合约安全库 (+20 分)
- ✅ 重入防护 (+15 分)
- ✅ 暂停机制 (+15 分)
- ✅ 输入验证 (+10 分)

**总分**: 100/100 分

## 📞 安全联系方式

如发现安全漏洞或需要安全支持：

- **GitHub Issues**: [安全报告](https://github.com/juzhiqiang/web3-school-backend/issues)
- **安全邮箱**: security@web3school.example (如有)
- **紧急联系**: 在 Issues 中标记 `security` 标签

---

**⚠️ 重要声明**: 
本项目不支持助记词部署方式。所有部署必须使用私钥或 Truffle Dashboard。任何尝试使用助记词的操作都会被拒绝。

**🔐 安全第一**: 我们优先考虑安全性而非便利性，确保您的资产和合约安全。
